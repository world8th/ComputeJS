!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=document.getElementById("gfx");i.width=i.height=640,new n.default(i).start()},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(i,a){function s(e){try{u(n.next(e))}catch(e){a(e)}}function o(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=new Float32Array([1,-1,0,-1,-1,0,0,1,0]),s=new Float32Array([1,0,0,0,1,0,0,0,1]),o=new Uint16Array([0,1,2]),u=(c.prototype.start=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.initializeAPI()];case 1:return e.sent()?(this.resizeBackings(),[4,this.initializeResources()]):[3,3];case 2:e.sent(),this.render(),e.label=3;case 3:return[2]}}))}))},c.prototype.initializeAPI=function(){return n(this,void 0,Promise,(function(){var e,t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),(e=navigator.gpu)?(t=this,[4,e.requestAdapter()]):[2,!1];case 1:return t.adapter=i.sent(),[4,(r=this).adapter.requestDevice()];case 2:return r.device=i.sent(),this.queue=this.device.defaultQueue,[3,4];case 3:return n=i.sent(),console.error(n),[2,!1];case 4:return[2,!0]}}))}))},c.prototype.initializeResources=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,u,c,d,h,l,f,p,v,m=this;return i(this,(function(i){switch(i.label){case 0:return e=function(e,t){var r={size:e.byteLength,usage:t},n=m.device.createBufferMapped(r),i=n[0],a=n[1];return new(e instanceof Uint16Array?Uint16Array:Float32Array)(a).set(e),i.unmap(),i},this.positionBuffer=e(a,GPUBufferUsage.VERTEX),this.colorBuffer=e(s,GPUBufferUsage.VERTEX),this.indexBuffer=e(o,GPUBufferUsage.INDEX),r={},[4,(t=function(e){return fetch(new Request(e),{method:"GET",mode:"cors"}).then((function(e){return e.arrayBuffer().then((function(e){return new Uint32Array(e)}))}))})("/assets/shaders/triangle.vert.spv")];case 1:return r.code=i.sent(),this.vertModule=this.device.createShaderModule(r),n={},[4,t("/assets/shaders/triangle.frag.spv")];case 2:return n.code=i.sent(),this.fragModule=this.device.createShaderModule(n),u={indexFormat:"uint16",vertexBuffers:[{attributes:[{shaderLocation:0,offset:0,format:"float3"}],arrayStride:12,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"float3"}],arrayStride:12,stepMode:"vertex"}]},c={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},d={bindGroupLayouts:[]},h=this.device.createPipelineLayout(d),l={module:this.vertModule,entryPoint:"main"},f={module:this.fragModule,entryPoint:"main"},p={format:"bgra8unorm",alphaBlend:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},colorBlend:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},writeMask:GPUColorWrite.ALL},v={layout:h,vertexStage:l,fragmentStage:f,primitiveTopology:"triangle-list",colorStates:[p],depthStencilState:c,vertexState:u,rasterizationState:{frontFace:"cw",cullMode:"none"}},this.pipeline=this.device.createRenderPipeline(v),[2]}}))}))},c.prototype.resizeBackings=function(){if(!this.swapchain){var e=this.canvas.getContext("gpupresent"),t={device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.OUTPUT_ATTACHMENT|GPUTextureUsage.COPY_SRC};this.swapchain=e.configureSwapChain(t)}var r={size:{width:this.canvas.width,height:this.canvas.height,depth:1},arrayLayerCount:1,mipLevelCount:1,sampleCount:1,dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.OUTPUT_ATTACHMENT|GPUTextureUsage.COPY_SRC};this.depthTexture=this.device.createTexture(r),this.depthTextureView=this.depthTexture.createView()},c.prototype.encodeCommands=function(){var e={colorAttachments:[{attachment:this.colorTextureView,loadValue:{r:0,g:0,b:0,a:1},storeOp:"store"}],depthStencilAttachment:{attachment:this.depthTextureView,depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:"load",stencilStoreOp:"store"}};this.commandEncoder=this.device.createCommandEncoder(),this.passEncoder=this.commandEncoder.beginRenderPass(e),this.passEncoder.setPipeline(this.pipeline),this.passEncoder.setViewport(0,0,this.canvas.width,this.canvas.height,0,1),this.passEncoder.setScissorRect(0,0,this.canvas.width,this.canvas.height),this.passEncoder.setVertexBuffer(0,this.positionBuffer),this.passEncoder.setVertexBuffer(1,this.colorBuffer),this.passEncoder.setIndexBuffer(this.indexBuffer),this.passEncoder.drawIndexed(3,1,0,0,0),this.passEncoder.endPass(),this.queue.submit([this.commandEncoder.finish()])},c);function c(e){var t=this;this.render=function(){t.colorTexture=t.swapchain.getCurrentTexture(),t.colorTextureView=t.colorTexture.createView(),t.encodeCommands(),requestAnimationFrame(t.render)},this.canvas=e}t.default=u}]);

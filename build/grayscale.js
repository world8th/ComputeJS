!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=2)}([,,function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(async()=>{let e=document.querySelector("#canvas"),t=e.getContext("2d"),r=new Image,n=new Promise((e,t)=>{r.onload=e,r.onerror=t});r.src="assets/images/test.png",await n;let a=(await Promise.resolve().then(()=>s(3))).default,i=await a.workgroup("./build/assembly/optimized.wasm",6,"\n        await (async (data)=>{\n            return instance.exports[data.name](id, ...data.args);\n        })");console.log("created workers!");const o=Math.min(e.width*e.height*4,1073741824),l=i.allocate(o);t.drawImage(r,0,0);let p=i.map(l,o,Uint8ClampedArray),u=t.getImageData(0,0,e.width,e.height);p.set(u.data),console.log("allocation of shared memory complete!"),await i.task({name:"main",args:[e.width,e.height,l]}).support(),console.log("compute done!"),u.data.set(p),t.putImageData(u,0,0)})()},function(e,t,s){"use strict";s.r(t);let r=(e="")=>`\nlet instance = null, threads = 1, id = 0;\n//let table = new WebAssembly.Table({initial: 1, maximum: 65536, shared: true, element: "anyfunc"});\n\n// thread native dispatcher \nonmessage = async (e)=>{\n    let result = null;\n    \n    if (e.data.type == "init") {\n        threads = e.data.threads, id = e.data.id;\n\n        instance = await WebAssembly.instantiate(e.data.module, { env: {\n            abort: function() { throw Error("abort called"); }, memory: e.data.memory\n        }});\n\n        result = await instance.exports.init(threads);\n    }\n    \n    if (e.data.type == "dispatch") {\n        result = await instance.exports[e.data.name](id, ...e.data.args);\n    }\n    \n    if (e.data.type == "support") {\n        result = ${e}(e.data);\n    }\n\n    postMessage(Object.assign(e.data, {result}));\n}\n`;class n{constructor(){}async initiate(e,t=1,s=""){this.workers=[];let n=new Blob([r(s)],{type:"text/javascript"}),a=URL.createObjectURL(n);for(let e=0;e<t;e++)this.workers.push(new Worker(a));this.reponseIndex=0,this.responses={};let i=this.reponseIndex++;return this.responses[i]=[],this.moduleFetch=(await fetch(e)).arrayBuffer(),this.module=await WebAssembly.compile(await this.moduleFetch),this.memory=new WebAssembly.Memory({initial:1,maximum:65536,shared:!0}),this.instance=await WebAssembly.instantiate(this.module,{env:{memory:this.memory,abort:function(){throw Error("abort called")}}}),this.instance.exports.init(t),this.workers.every(async(e,s)=>{e.responses={},e.onmessage=t=>{e.responses[t.data.response].resolved=t.data};let r={};e.responses[i]=r,this.responses[i][s]=new Promise((e,t)=>{Object.defineProperty(r,"resolved",{set:s=>{s?e(s):t()}})}),e.postMessage({response:i,type:"init",module:this.module,memory:this.memory,threads:t,id:s})}),await Promise.all(this.responses[i]),this}async wait(e){let t=await Promise.all(this.responses[e]);return delete this.responses[e],t}task({name:e="main",args:t=[]}){let s=this.reponseIndex++;return this.responses[s]=[],this.workers.every(async(e,t)=>{let r={};e.responses[s]=r,this.responses[s][t]=new Promise((e,t)=>{Object.defineProperty(r,"resolved",{set:s=>{s?e(s):t()}})})}),new a({name:e,args:t,resp:s,workgroup:this})}allocate(e=4){return this.instance.exports.allocate(e)}free(e){return this.instance.exports.free(e)}map(e,t=0,s=Uint8Array){return t?new s(this.instance.exports.memory.buffer,e,t):new s(this.instance.exports.memory.buffer,e)}}class a{constructor({name:e="main",args:t=[],resp:s=0,workgroup:r}){this.workgroup=r,this.resp=s,this.args=t,this.name=e}async dispatch(){return this.workgroup.workers.every(async(e,t)=>{e.postMessage({type:"dispatch",id:t,response:this.resp,name:this.name,args:this.args})}),this.workgroup.wait(this.resp)}async support(){return this.workgroup.workers.every(async(e,t)=>{e.postMessage({type:"support",id:t,response:this.resp,name:this.name,args:this.args})}),this.workgroup.wait(this.resp)}get id(){return this.resp}}t.default={init:async()=>0,workgroup:async(e,t=1,s="")=>(new n).initiate(e,t,s)}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vZ3JheXNjYWxlLnRzIiwid2VicGFjazovLy8uLi9idWlsZC9saWIvY29tcHV0ZS5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImNhbnZhcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImN0eCIsImdldENvbnRleHQiLCJpbWFnZSIsIkltYWdlIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25sb2FkIiwib25lcnJvciIsInNyYyIsImNvbXB1dGUiLCJkZWZhdWx0Iiwid29ya2dyb3VwIiwiY29uc29sZSIsImxvZyIsInNpemUiLCJNYXRoIiwibWluIiwid2lkdGgiLCJoZWlnaHQiLCJidWZmZXIiLCJhbGxvY2F0ZSIsImRyYXdJbWFnZSIsIm1hcCIsIlVpbnQ4Q2xhbXBlZEFycmF5IiwiaW1nIiwiZ2V0SW1hZ2VEYXRhIiwic2V0IiwiZGF0YSIsInRhc2siLCJhcmdzIiwic3VwcG9ydCIsInB1dEltYWdlRGF0YSIsIlRocmVhZENvZGUiLCJXb3JrZ3JvdXAiLCJ0aHJlYWRzIiwic3VwcG9ydENvZGUiLCJ0aGlzIiwid29ya2VycyIsImJsb2IiLCJCbG9iIiwidHlwZSIsInVybCIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsInB1c2giLCJXb3JrZXIiLCJyZXBvbnNlSW5kZXgiLCJyZXNwb25zZXMiLCJyZXNwIiwibW9kdWxlRmV0Y2giLCJmZXRjaCIsImFycmF5QnVmZmVyIiwiV2ViQXNzZW1ibHkiLCJjb21waWxlIiwibWVtb3J5IiwiTWVtb3J5IiwiaW5pdGlhbCIsIm1heGltdW0iLCJzaGFyZWQiLCJpbnN0YW5jZSIsImluc3RhbnRpYXRlIiwiZW52IiwiYWJvcnQiLCJFcnJvciIsImluaXQiLCJldmVyeSIsImFzeW5jIiwidyIsIm9ubWVzc2FnZSIsImUiLCJyZXNwb25zZSIsInJlc29sdmVkIiwicG9zdE1lc3NhZ2UiLCJpZCIsImFsbCIsInJlc3VsdCIsIldvcmt0YXNrIiwicG9pbnRlciIsImZyZWUiLCJwdHIiLCJyYW5nZSIsIlVpbnQ4QXJyYXkiLCJ3YWl0IiwiaW5pdGlhdGUiXSwibWFwcGluZ3MiOiJhQUNFLElBQUlBLEVBQW1CLEdBR3ZCLFNBQVNDLEVBQW9CQyxHQUc1QixHQUFHRixFQUFpQkUsR0FDbkIsT0FBT0YsRUFBaUJFLEdBQVVDLFFBR25DLElBQUlDLEVBQVNKLEVBQWlCRSxHQUFZLENBQ3pDRyxFQUFHSCxFQUNISSxHQUFHLEVBQ0hILFFBQVMsSUFVVixPQU5BSSxFQUFRTCxHQUFVTSxLQUFLSixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTRixHQUcvREcsRUFBT0UsR0FBSSxFQUdKRixFQUFPRCxRQUtmRixFQUFvQlEsRUFBSUYsRUFHeEJOLEVBQW9CUyxFQUFJVixFQUd4QkMsRUFBb0JVLEVBQUksU0FBU1IsRUFBU1MsRUFBTUMsR0FDM0NaLEVBQW9CYSxFQUFFWCxFQUFTUyxJQUNsQ0csT0FBT0MsZUFBZWIsRUFBU1MsRUFBTSxDQUFFSyxZQUFZLEVBQU1DLElBQUtMLEtBS2hFWixFQUFvQmtCLEVBQUksU0FBU2hCLEdBQ1gsb0JBQVhpQixRQUEwQkEsT0FBT0MsYUFDMUNOLE9BQU9DLGVBQWViLEVBQVNpQixPQUFPQyxZQUFhLENBQUVDLE1BQU8sV0FF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MEIsUUFBUTRCLE1BQU1DLE1BQU9DLEVBQUV4RyxLQUNsQ3dHLEVBQUVLLFlBQVksQ0FBRWhDLEtBQU0sVUFBV2lDLEdBQUc5RyxFQUFHMkcsU0FBVWxDLEtBQUtZLEtBQU05RSxLQUFNa0UsS0FBS2xFLEtBQU0yRCxLQUFNTyxLQUFLUCxTQUVyRk8sS0FBS3pCLFVBQVV1RSxLQUFLOUMsS0FBS1ksTUFJcEMsU0FBVyxPQUFPWixLQUFLWSxNQUdaLFdBQ1gsS0FBVSxTQUFZLEVBQ3RCLFVBQWUsTUFBQ3RGLEVBQVF3RSxFQUFVLEVBQUVKLEVBQVEsTUFDakMsSUFBSUcsR0FBWWtELFNBQVN6SCxFQUFPd0UsRUFBUUoiLCJmaWxlIjoiZ3JheXNjYWxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL2J1aWxkL2xpYi9jb21wdXRlLmQudHNcIiAvPlxyXG5cclxuaW1wb3J0IHsgQ29tcHV0ZSB9IGZyb20gXCIuLi9idWlsZC9saWIvY29tcHV0ZS5qc1wiO1xyXG5cclxuKGFzeW5jICgpPT57XHJcbiAgICBsZXQgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FudmFzXCIpO1xyXG4gICAgbGV0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcblxyXG4gICAgLy8gbG9hZCBpbWFnZSAoc2ltcGxlcilcclxuICAgIGxldCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSxyZWplY3QpPT57XHJcbiAgICAgICAgaW1hZ2Uub25sb2FkPXJlc29sdmU7XHJcbiAgICAgICAgaW1hZ2Uub25lcnJvcj1yZWplY3Q7XHJcbiAgICB9KTtcclxuICAgIGltYWdlLnNyYyA9IFwiYXNzZXRzL2ltYWdlcy90ZXN0LnBuZ1wiO1xyXG4gICAgYXdhaXQgcHJvbWlzZTtcclxuXHJcbiAgICAvLyBpbXBvcnQgY29tcHV0ZSBsaWJyYXJ5IFxyXG4gICAgbGV0IGNvbXB1dGU6IENvbXB1dGUuTW9kdWxlID0gKGF3YWl0IGltcG9ydChcIi4vYnVpbGQvbGliL2NvbXB1dGUuanNcIikpLmRlZmF1bHQ7IC8vIFJlcXVpcmVkIFR5cGUgQ29udmVyc2lvblxyXG4gICAgXHJcbiAgICAvLyBjcmVhdGUgd2FzbSB3b3JrZ3JvdXAgKDQgdGhyZWFkcykgd2l0aCBtb2R1bGVcclxuICAgIGxldCB3b3JrZ3JvdXAgPSBhd2FpdCBjb21wdXRlLndvcmtncm91cChcIi4vYnVpbGQvYXNzZW1ibHkvb3B0aW1pemVkLndhc21cIiwgNiwgYFxyXG4gICAgICAgIGF3YWl0IChhc3luYyAoZGF0YSk9PntcclxuICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlLmV4cG9ydHNbZGF0YS5uYW1lXShpZCwgLi4uZGF0YS5hcmdzKTtcclxuICAgICAgICB9KWApO1xyXG4gICAgY29uc29sZS5sb2coXCJjcmVhdGVkIHdvcmtlcnMhXCIpO1xyXG5cclxuICAgIC8vIGFsbG9jYXRlIHNoYXJlZCBtZW1vcnkgZm9yIHdvcmtcclxuICAgIGNvbnN0IHNpemUgPSBNYXRoLm1pbihjYW52YXMud2lkdGgqY2FudmFzLmhlaWdodCo0LDEwMjQqMTAyNCoxMDI0KTtcclxuICAgIGNvbnN0IGJ1ZmZlciA9IHdvcmtncm91cC5hbGxvY2F0ZShzaXplKTsgLy8ganVzdCBudW1iZXIgcG9pbnRlclxyXG5cclxuICAgIC8vIFxyXG4gICAgY3R4LmRyYXdJbWFnZShpbWFnZSwwLDApO1xyXG5cclxuICAgIC8vIG1ha2UgdHlwZWQgYXJyYXkgYW5kIHNldCB3aXRoIGltYWdlIGRhdGEgXHJcbiAgICBsZXQgbWFwID0gd29ya2dyb3VwLm1hcDxVaW50OENsYW1wZWRBcnJheT4oYnVmZmVyLHNpemUsVWludDhDbGFtcGVkQXJyYXkpO1xyXG4gICAgbGV0IGltZyA9IGN0eC5nZXRJbWFnZURhdGEoMCwwLGNhbnZhcy53aWR0aCxjYW52YXMuaGVpZ2h0KTtcclxuICAgIG1hcC5zZXQoaW1nLmRhdGEpOyAvLyBzZXQgYnkgbWFwcGVkIHJhbmdlXHJcbiAgICBjb25zb2xlLmxvZyhcImFsbG9jYXRpb24gb2Ygc2hhcmVkIG1lbW9yeSBjb21wbGV0ZSFcIik7XHJcblxyXG4gICAgLy8gUnVuIFwic3VwcG9ydFwiIHRhc2sgKGNhbiBydW4gXCJtYWluXCIgd2l0aG91dCBpbnB1dCBkYXRhKVxyXG4gICAgYXdhaXQgd29ya2dyb3VwLnRhc2soe25hbWU6IFwibWFpblwiLCBhcmdzOiBbY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0LCBidWZmZXJdfSkuc3VwcG9ydCgpO1xyXG4gICAgY29uc29sZS5sb2coXCJjb21wdXRlIGRvbmUhXCIpO1xyXG5cclxuICAgIC8vIHB1dCBpbWFnZURhdGFcclxuICAgIGltZy5kYXRhLnNldChtYXApO1xyXG4gICAgY3R4LnB1dEltYWdlRGF0YShpbWcsMCwwKTtcclxufSkoKTtcclxuIiwiXG5sZXQgVGhyZWFkQ29kZSA9IChzdXBwb3J0ID0gYGApPT57IHJldHVybiBgXG5sZXQgaW5zdGFuY2UgPSBudWxsLCB0aHJlYWRzID0gMSwgaWQgPSAwO1xuLy9sZXQgdGFibGUgPSBuZXcgV2ViQXNzZW1ibHkuVGFibGUoe2luaXRpYWw6IDEsIG1heGltdW06IDY1NTM2LCBzaGFyZWQ6IHRydWUsIGVsZW1lbnQ6IFwiYW55ZnVuY1wifSk7XG5cbi8vIHRocmVhZCBuYXRpdmUgZGlzcGF0Y2hlciBcbm9ubWVzc2FnZSA9IGFzeW5jIChlKT0+e1xuICAgIGxldCByZXN1bHQgPSBudWxsO1xuICAgIFxuICAgIGlmIChlLmRhdGEudHlwZSA9PSBcImluaXRcIikge1xuICAgICAgICB0aHJlYWRzID0gZS5kYXRhLnRocmVhZHMsIGlkID0gZS5kYXRhLmlkO1xuXG4gICAgICAgIGluc3RhbmNlID0gYXdhaXQgV2ViQXNzZW1ibHkuaW5zdGFudGlhdGUoZS5kYXRhLm1vZHVsZSwgeyBlbnY6IHtcbiAgICAgICAgICAgIGFib3J0OiBmdW5jdGlvbigpIHsgdGhyb3cgRXJyb3IoXCJhYm9ydCBjYWxsZWRcIik7IH0sIG1lbW9yeTogZS5kYXRhLm1lbW9yeVxuICAgICAgICB9fSk7XG5cbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgaW5zdGFuY2UuZXhwb3J0cy5pbml0KHRocmVhZHMpO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZS5kYXRhLnR5cGUgPT0gXCJkaXNwYXRjaFwiKSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IGluc3RhbmNlLmV4cG9ydHNbZS5kYXRhLm5hbWVdKGlkLCAuLi5lLmRhdGEuYXJncyk7XG4gICAgfVxuICAgIFxuICAgIGlmIChlLmRhdGEudHlwZSA9PSBcInN1cHBvcnRcIikge1xuICAgICAgICByZXN1bHQgPSAke3N1cHBvcnR9KGUuZGF0YSk7XG4gICAgfVxuXG4gICAgcG9zdE1lc3NhZ2UoT2JqZWN0LmFzc2lnbihlLmRhdGEsIHtyZXN1bHR9KSk7XG59XG5gfTtcblxuY2xhc3MgV29ya2dyb3VwIHtcbiAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgYXN5bmMgaW5pdGlhdGUobW9kdWxlLCB0aHJlYWRzID0gMSwgc3VwcG9ydENvZGUgPSBgYCl7XG4gICAgICAgIC8vV2ViQXNzZW1ibHkuaW5zdGFudGlhdGVTdHJlYW1pbmcoZmV0Y2goXG4gICAgICAgIHRoaXMud29ya2VycyA9IFtdO1xuXG4gICAgICAgIC8vIGluaXRpYWxpemUgdGhyZWFkc1xuICAgICAgICBsZXQgYmxvYiA9IG5ldyBCbG9iKFtUaHJlYWRDb2RlKHN1cHBvcnRDb2RlKV0se3R5cGU6XCJ0ZXh0L2phdmFzY3JpcHRcIn0pLCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICBmb3IgKGxldCBpPTA7aTx0aHJlYWRzO2krKykgeyB0aGlzLndvcmtlcnMucHVzaChuZXcgV29ya2VyKHVybCkpOyB9XG5cbiAgICAgICAgLy8gXG4gICAgICAgIHRoaXMucmVwb25zZUluZGV4ID0gMCwgdGhpcy5yZXNwb25zZXMgPSB7fTtcblxuICAgICAgICAvLyBcbiAgICAgICAgbGV0IHJlc3AgPSB0aGlzLnJlcG9uc2VJbmRleCsrO1xuICAgICAgICB0aGlzLnJlc3BvbnNlc1tyZXNwXSA9IFtdO1xuXG4gICAgICAgIC8vIGluaXRpYWxpemUgd29ya2Vyc1xuICAgICAgICB0aGlzLm1vZHVsZUZldGNoID0gKGF3YWl0IGZldGNoKG1vZHVsZSkpLmFycmF5QnVmZmVyKCk7XG4gICAgICAgIHRoaXMubW9kdWxlID0gYXdhaXQgV2ViQXNzZW1ibHkuY29tcGlsZShhd2FpdCB0aGlzLm1vZHVsZUZldGNoKTtcblxuICAgICAgICAvLyBjcmVhdGUgc2hhcmVkIG1lbW9yeSBtb2RlbFxuICAgICAgICB0aGlzLm1lbW9yeSA9IG5ldyBXZWJBc3NlbWJseS5NZW1vcnkoe2luaXRpYWw6IDEsIG1heGltdW06IDY1NTM2LCBzaGFyZWQ6IHRydWV9KTtcbiAgICAgICAgLy90aGlzLnRhYmxlID0gbmV3IFdlYkFzc2VtYmx5LlRhYmxlKHtpbml0aWFsOiAxLCBtYXhpbXVtOiA2NTUzNiwgc2hhcmVkOiB0cnVlLCBlbGVtZW50OiBcImFueWZ1bmNcIn0pO1xuXG4gICAgICAgIC8vIGNyZWF0ZSBob3N0L21hbmFnZXIgaW5zdGFuY2VcbiAgICAgICAgdGhpcy5pbnN0YW5jZSA9IGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKHRoaXMubW9kdWxlLCB7IGVudjoge1xuICAgICAgICAgICAgbWVtb3J5OiB0aGlzLm1lbW9yeSxcbiAgICAgICAgICAgIGFib3J0OiBmdW5jdGlvbigpIHsgdGhyb3cgRXJyb3IoXCJhYm9ydCBjYWxsZWRcIik7IH1cbiAgICAgICAgfX0pO1xuICAgICAgICB0aGlzLmluc3RhbmNlLmV4cG9ydHMuaW5pdCh0aHJlYWRzKTtcblxuICAgICAgICB0aGlzLndvcmtlcnMuZXZlcnkoYXN5bmMgKHcsaSk9PntcbiAgICAgICAgICAgIHcucmVzcG9uc2VzID0ge307XG4gICAgICAgICAgICB3Lm9ubWVzc2FnZSA9IChlKT0+eyB3LnJlc3BvbnNlc1tlLmRhdGEucmVzcG9uc2VdLnJlc29sdmVkID0gZS5kYXRhOyB9O1xuXG4gICAgICAgICAgICAvLyBhZGQgbmV3IHRhc2sgaW50byB3b3JrZXJcbiAgICAgICAgICAgIGxldCByZXNwb25zZSA9IHt9OyB3LnJlc3BvbnNlc1tyZXNwXSA9IHJlc3BvbnNlOyAvLyBpbml0aWFsaXplIHJlc29sdmVyXG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlc1tyZXNwXVtpXSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLHJlamVjdCk9PnsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc3BvbnNlLCBcInJlc29sdmVkXCIsIHtzZXQ6IHZhbHVlID0+IHsgdmFsdWU/cmVzb2x2ZSh2YWx1ZSk6cmVqZWN0KCk7IH19KTsgfSk7XG5cbiAgICAgICAgICAgIC8vIHNlbmQgY29tbWFuZCBpbnRvIHdvcmtlclxuICAgICAgICAgICAgdy5wb3N0TWVzc2FnZSh7IHJlc3BvbnNlOiByZXNwLCB0eXBlOiBcImluaXRcIiwgbW9kdWxlOiB0aGlzLm1vZHVsZSwgbWVtb3J5OiB0aGlzLm1lbW9yeSwgdGhyZWFkcywgaWQ6IGkgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGF3YWl0IGluaXRpYWxpemF0aW9uIG9mIHdvcmtlcnNcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwodGhpcy5yZXNwb25zZXNbcmVzcF0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIHdhaXQgdGFzayBieSBJRFxuICAgIGFzeW5jIHdhaXQocmVzcCl7XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLnJlc3BvbnNlc1tyZXNwXSk7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnJlc3BvbnNlc1tyZXNwXTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgXG4gICAgLy8gY3JlYXRlIHdvcmsgdGFzayBcbiAgICB0YXNrKHtuYW1lPVwibWFpblwiLGFyZ3M9W119KXtcbiAgICAgICAgLy8gXG4gICAgICAgIGxldCByZXNwID0gdGhpcy5yZXBvbnNlSW5kZXgrKztcbiAgICAgICAgdGhpcy5yZXNwb25zZXNbcmVzcF0gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIGFkZCBuZXcgdGFzayBpbnRvIHdvcmtlclxuICAgICAgICB0aGlzLndvcmtlcnMuZXZlcnkoYXN5bmMgKHcsaSk9PntcbiAgICAgICAgICAgIGxldCByZXNwb25zZSA9IHt9OyB3LnJlc3BvbnNlc1tyZXNwXSA9IHJlc3BvbnNlOyAvLyBpbml0aWFsaXplIHJlc29sdmVyXG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlc1tyZXNwXVtpXSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLHJlamVjdCk9PnsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc3BvbnNlLCBcInJlc29sdmVkXCIsIHtzZXQ6IHZhbHVlID0+IHsgdmFsdWU/cmVzb2x2ZSh2YWx1ZSk6cmVqZWN0KCk7IH19KTsgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBuZXcgV29ya3Rhc2soe25hbWUsYXJncyxyZXNwLHdvcmtncm91cDp0aGlzfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIGFsbG9jYXRlIG1lbW9yeSBmb3Igd29ya1xuICAgIGFsbG9jYXRlKHNpemUgPSA0KXtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2UuZXhwb3J0cy5hbGxvY2F0ZShzaXplKTtcbiAgICB9XG5cbiAgICAvLyBmcmVlIG1lbW9yeSBwb2ludGVyXG4gICAgZnJlZShwb2ludGVyKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2UuZXhwb3J0cy5mcmVlKHBvaW50ZXIpO1xuICAgIH1cblxuICAgIC8vIGdldCB3b3JrZ3JvdXAgbWVtb3J5IG9iamVjdCBcbiAgICBtYXAocHRyLCByYW5nZSA9IDAsIHR5cGUgPSBVaW50OEFycmF5KXtcbiAgICAgICAgaWYgKHJhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IHR5cGUodGhpcy5pbnN0YW5jZS5leHBvcnRzLm1lbW9yeS5idWZmZXIsIHB0ciwgcmFuZ2UpOyAvLyBSYW5nZWRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgdHlwZSh0aGlzLmluc3RhbmNlLmV4cG9ydHMubWVtb3J5LmJ1ZmZlciwgcHRyKTsgLy8gV2hvbGUgU2l6ZSAobWF5IHVzZWQgZm9yIFdlYkdQVSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgV29ya3Rhc2sge1xuICAgIGNvbnN0cnVjdG9yKHtuYW1lPVwibWFpblwiLGFyZ3M9W10scmVzcD0wLHdvcmtncm91cH0pIHtcbiAgICAgICAgdGhpcy53b3JrZ3JvdXAgPSB3b3JrZ3JvdXAsIHRoaXMucmVzcCA9IHJlc3AsIHRoaXMuYXJncyA9IGFyZ3MsIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxuXG4gICAgLy8gc2VuZCBjb21tYW5kIGZvciBjb21wdXRpbmdcbiAgICBhc3luYyBkaXNwYXRjaCgpIHtcbiAgICAgICAgLy8vcmV0dXJuIHRoaXMud29ya2dyb3VwLmluc3RhbmNlLmV4cG9ydHNbdGhpcy5uYW1lXSgwLCAuLi50aGlzLmFyZ3MpO1xuICAgICAgICB0aGlzLndvcmtncm91cC53b3JrZXJzLmV2ZXJ5KGFzeW5jICh3LGkpPT57XG4gICAgICAgICAgICB3LnBvc3RNZXNzYWdlKHsgdHlwZTogXCJkaXNwYXRjaFwiLCBpZDppLCByZXNwb25zZTogdGhpcy5yZXNwLCBuYW1lOiB0aGlzLm5hbWUsIGFyZ3M6IHRoaXMuYXJncyB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtncm91cC53YWl0KHRoaXMucmVzcCk7XG4gICAgfVxuXG4gICAgLy8gc2VuZCBjb21tYW5kIGZvciBqYXZhc2NyaXB0IGhvc3QgbWFuYWdlclxuICAgIGFzeW5jIHN1cHBvcnQoKSB7XG4gICAgICAgIC8vL3JldHVybiB0aGlzLndvcmtncm91cC5pbnN0YW5jZS5leHBvcnRzW3RoaXMubmFtZV0oMCwgLi4udGhpcy5hcmdzKTtcbiAgICAgICAgdGhpcy53b3JrZ3JvdXAud29ya2Vycy5ldmVyeShhc3luYyAodyxpKT0+e1xuICAgICAgICAgICAgdy5wb3N0TWVzc2FnZSh7IHR5cGU6IFwic3VwcG9ydFwiLCBpZDppLCByZXNwb25zZTogdGhpcy5yZXNwLCBuYW1lOiB0aGlzLm5hbWUsIGFyZ3M6IHRoaXMuYXJncyB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLndvcmtncm91cC53YWl0KHRoaXMucmVzcCk7XG4gICAgfVxuXG4gICAgLy8gZ2V0IHRhc2sgSUQgKG5vdCByZWNvbW1lbmRlZClcbiAgICBnZXQgaWQoKSB7IHJldHVybiB0aGlzLnJlc3A7IH1cbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICAgIGFzeW5jIGluaXQoKSB7IHJldHVybiAwOyB9LFxuICAgIGFzeW5jIHdvcmtncm91cChtb2R1bGUsIHRocmVhZHMgPSAxLHN1cHBvcnQ9YGApIHtcbiAgICAgICAgcmV0dXJuIG5ldyBXb3JrZ3JvdXAoKS5pbml0aWF0ZShtb2R1bGUsdGhyZWFkcyxzdXBwb3J0KTtcbiAgICB9XG59O1xuIl0sInNvdXJjZVJvb3QiOiIifQ==